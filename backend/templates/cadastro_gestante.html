<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Gestante</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script>
        // Função para calcular a idade com base na data de nascimento
        function calcularIdade() {
            var dataNascimento = document.getElementById("data_nascimento").value;
            if (dataNascimento) {
                var hoje = new Date();
                var nascimento = new Date(dataNascimento);
                var idade = hoje.getFullYear() - nascimento.getFullYear();
                var m = hoje.getMonth() - nascimento.getMonth();
                if (m < 0 || (m === 0 && hoje.getDate() < nascimento.getDate())) {
                    idade--;
                }
                document.getElementById("idade").value = idade;
            }
        }

        // Função para buscar gestante pelo CPF
        function buscarGestantePorCpf() {
            var cpf = document.getElementById("cpf").value;
            if (cpf) {
                fetch(`/buscar_gestante/${cpf}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data) {
                            // Preencher os campos do formulário com os dados da gestante encontrada
                            document.getElementById("nome").value = data.nome;
                            document.getElementById("data_nascimento").value = data.data_nascimento;
                            calcularIdade(); // Calcular a idade automaticamente
                            document.getElementById("nome_mae").value = data.nome_mae;
                            document.getElementById("data_prevista_parto").value = data.data_prevista_parto;
                            document.getElementById("ultima_menstruacao").value = data.ultima_menstruacao;
                            document.getElementById("endereco").value = data.endereco;
                            document.getElementById("cep").value = data.cep;
                            document.getElementById("cidade").value = data.cidade;
                            document.getElementById("estado").value = data.estado;
                            document.getElementById("telefone").value = data.telefone;
                        } else {
                            alert("Gestante não encontrada!");
                        }
                    })
                    .catch(error => console.error("Erro ao buscar gestante:", error));
            }
        }
    </script>
</head>
<body>

    <div class="container">
        <h1>Cadastro de Gestante</h1>

        <!-- Formulário para cadastro de gestante -->
      <form action="/submit" method="POST">

            <label for="cpf">CPF:</label>
            <input type="text" id="cpf" name="cpf" required oninput="buscarGestantePorCpf()">

            <label for="nome">Nome da Gestante:</label>
            <input type="text" id="nome" name="nome" required>

            <label for="data_nascimento">Data de Nascimento:</label>
            <input type="date" id="data_nascimento" name="data_nascimento" required oninput="calcularIdade()">

            <label for="idade">Idade:</label>
            <input type="text" id="idade" name="idade" readonly>

            <label for="nome_mae">Nome da Mãe:</label>
            <input type="text" id="nome_mae" name="nome_mae" required>

            <label for="data_prevista_parto">Data Prevista para o Parto:</label>
            <input type="date" id="data_prevista_parto" name="data_prevista_parto" required>

            <label for="ultima_menstruacao">Última Menstruação:</label>
            <input type="date" id="ultima_menstruacao" name="ultima_menstruacao" required>

            <label for="endereco">Endereço:</label>
            <input type="text" id="endereco" name="endereco" required>

            <label for="cep">CEP:</label>
            <input type="text" id="cep" name="cep" required>

            <label for="cidade">Cidade:</label>
            <input type="text" id="cidade" name="cidade" required>

            <label for="estado">Estado:</label>
            <input type="text" id="estado" name="estado" required>

            <label for="telefone">Telefone:</label>
            <input type="text" id="telefone" name="telefone" required>

            <button type="submit">Cadastrar</button>
        </form>

        <br>

        <!-- Após cadastro, redireciona para o cronograma -->
        {% if gestante.id %}
        <a href="/cronograma/{{ gestante.id }}" class="btn btn-primary">Ir para o Cronograma de Exames</a>
        {% endif %}

    </div>

</body>
</html>

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cronograma de Exames - Pré-Natal</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Cronograma de Exames - Pré-Natal</h1>

    <form id="search-form">
        <label for="cpf">CPF da Gestante:</label>
        <input type="text" id="cpf" name="cpf" placeholder="Digite o CPF" required>
        <button type="submit">Buscar</button>
    </form>

    <h2 id="gestante-nome">Nome da Gestante: <span id="nome-gestante">N/A</span></h2>

    <table id="cronograma-table" border="1">
        <thead>
            <tr>
                <th>Abertura do Pré-Natal</th>
                <th>Consulta inicial</th>
                <th>Avaliação odontológica</th>
                <th>Exames laboratoriais</th>
                <th>Sorologias e Teste rápido</th>
                <th>Exames Radiológicos</th>
                <th>Toxoplasmose</th>
                <th>SUAB</th>
                <th>Laqueadura</th>
                <th>Vacinas</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Ate 6 semanas</td>
                <td contenteditable="true" class="editable pending" tabindex="18">Assim que descobre a gravidez</td>
                <td contenteditable="true" class="editable upcoming" tabindex="19">Assim que descobre a gravidez</td>
                <td contenteditable="true" class="editable upcoming" tabindex="20">Assim que descobre a gravidez</td>
                <td contenteditable="true" class="editable upcoming" tabindex="21">Assim que descobre a gravidez</td>
                <td contenteditable="true" class="editable upcoming" tabindex="22">Na abertura Pre-Natal</td>
                <td contenteditable="true" class="editable upcoming" tabindex="23">USG Obstetrico</td>
                <td contenteditable="true" class="editable upcoming" tabindex="24"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="25"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="26">1º reunião na abertura PN</td>
                <td contenteditable="true" class="editable upcoming" tabindex="27">Na abertura Pre-Natal</td>
            </tr>
            <tr>
                <td>Ate 28 semanas</td>
                <td contenteditable="true" class="editable pending" tabindex="28"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="29">Uma vez por mês</td>
                <td contenteditable="true" class="editable upcoming" tabindex="30"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="31"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="32"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="33"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="34"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="35"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="36"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="37"></td>
            </tr>
            <tr>
                <td>De 29 a 35 semanas</td>
                <td contenteditable="true" class="editable pending" tabindex="38"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="39">Quinzenal</td>
                <td contenteditable="true" class="editable upcoming" tabindex="40"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="41"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="42"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="43"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="44"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="45"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="46"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="47"></td>
            </tr>
            <tr>
                <td>Apos 36 semanas</td>
                <td contenteditable="true" class="editable pending" tabindex="48"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="49">Semanal</td>
                <td contenteditable="true" class="editable upcoming" tabindex="50"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="51"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="52"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="53"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="54"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="55"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="56"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="57"></td>
            </tr>
            <tr>
                <td>A cada Trimestre</td>
                <td contenteditable="true" class="editable pending" tabindex="58"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="59"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="60">Avaliação</td>
                <td contenteditable="true" class="editable upcoming" tabindex="61">Colher</td>
                <td contenteditable="true" class="editable upcoming" tabindex="62">Colher</td>
                <td contenteditable="true" class="editable upcoming" tabindex="63"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="64">Colher</td>
                <td contenteditable="true" class="editable upcoming" tabindex="65"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="66"></td>
                <td contenteditable="true" class="editable upcoming" tabindex="67"></td>
            </tr>
        </tbody>
    </table>

    <button id="save-changes">Salvar Alterações</button>

    <script>
        $(document).ready(function() {
            // Função de buscar dados da gestante
            $('#search-form').on('submit', function(event) {
                event.preventDefault();
                var cpf = $('#cpf').val();
                
                $.ajax({
                    url: `/api/gestante/${cpf}`,  // Rota que buscará os dados da gestante
                    method: 'GET',
                    data: { cpf: cpf },
                    success: function(data) {
                        $('#nome-gestante').text(data.nome);
                        // Aqui, você pode preencher a tabela com dados específicos se necessário
                    },
                    error: function() {
                        alert('Gestante não encontrada!');
                    }
                });
            });

            // Função para salvar as alterações feitas na tabela
            $('#save-changes').on('click', function() {
                var tableData = [];
                $('#cronograma-table tbody tr').each(function() {
                    var rowData = {};
                    $(this).find('td').each(function(index) {
                        var statusClass = $(this).attr('class');
                        rowData[index] = {
                            value: $(this).text(),
                            status: statusClass
                        };
                    });
                    tableData.push(rowData);
                });

                $.ajax({
                    url: '/salvar_cronograma',  // Rota que salvará as alterações no banco
                    method: 'POST',
                    data: { cronograma: tableData },
                    success: function(response) {
                        alert('Alterações salvas com sucesso!');
                    },
                    error: function() {
                        alert('Erro ao salvar alterações.');
                    }
                });
            });
        });
    </script>
</body>
</html>
